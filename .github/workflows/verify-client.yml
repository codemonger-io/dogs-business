name: "Verifies the client"

on:
  - push
  - pull_request

defaults:
  run:
    shell: bash
    working-directory: ./client

jobs:
  verify-client:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v6

      - name: Set up Node.js and pnpm
        uses: ./.github/actions/setup-node-and-pnpm
        with:
          working-directory: ./client

      - name: Install dependencies
        env:
          NODE_AUTH_TOKEN: ${{ secrets.PACKAGE_READER_PAT }} # necessary to install packages from GitHub package registry
        run: pnpm install

      - name: Run type checking
        id: type-check
        continue-on-error: true # reports later
        run: pnpm type-check

      - name: Run lint
        id: lint
        continue-on-error: true # reports later
        run: pnpm lint

      - name: Run unit tests
        id: unit-tests
        continue-on-error: true # reports later
        run: pnpm test:unit --silent

      - name: Report results
        run: |
          if [[ "${{ steps.type-check.outcome }}" == "failure" ]]; then
            echo -e "\033[0;31mType checking failed."
          fi

          if [[ "${{ steps.lint.outcome }}" == "failure" ]]; then
            echo -e "\033[0;31mLinting failed."
          fi

          if [[ "${{ steps.unit-tests.outcome }}" == "failure" ]]; then
            echo -e "\033[0;31mUnit tests failed."
          fi

          if [[ \
            "${{ steps.type-check.outcome }}" == "failure" \
            || "${{ steps.lint.outcome }}" == "failure" \
            || "${{ steps.unit-tests.outcome }}" == "failure" \
          ]]; then
            exit 1
          fi
          echo "All checks passed successfully."
